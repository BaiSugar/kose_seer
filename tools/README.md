# å¼€å‘å·¥å…·ä½¿ç”¨æŒ‡å—

æœ¬ç›®å½•åŒ…å«ç”¨äºå¼€å‘çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¸®åŠ©æé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚

## å·¥å…·åˆ—è¡¨

### 1. Metaå’ŒProtoåŒå‘è½¬æ¢å·¥å…· (`meta-proto-converter.ts`)

å®ç° Meta å…ƒæ•°æ®å’Œ Proto ç±»ä¹‹é—´çš„åŒå‘è½¬æ¢ã€‚

#### Proto â†’ Metaï¼ˆä»Protoç”Ÿæˆå…ƒæ•°æ®ï¼‰

**ç”¨é€”ï¼š** æ‰«æç°æœ‰çš„ Proto ç±»ï¼Œè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„å…ƒæ•°æ®å®šä¹‰ã€‚

**å‘½ä»¤ï¼š**
```bash
# æµ‹è¯•æ¨¡å¼ï¼ˆç”Ÿæˆåˆ° test-output/ ç›®å½•ï¼‰
npm run tools:proto-to-meta -- --test

# æ­£å¼æ¨¡å¼ï¼ˆç”Ÿæˆåˆ° src/shared/protocol/meta/ ç›®å½•ï¼‰
npm run tools:proto-to-meta

# è½¬æ¢å•ä¸ªæ–‡ä»¶
npm run tools:proto-to-meta -- --test src/shared/proto/packets/req/login/LoginReqProto.ts
```

**è¾“å‡ºï¼š**
- æµ‹è¯•æ¨¡å¼ï¼š`test-output/generated.meta.ts`
- æ­£å¼æ¨¡å¼ï¼š`src/shared/protocol/meta/generated.meta.ts`

**ä½¿ç”¨ç”Ÿæˆçš„å…ƒæ•°æ®ï¼š**
```typescript
// åœ¨ src/shared/protocol/meta/index.ts ä¸­
import { GeneratedMetadata } from './generated.meta';

CmdMeta.RegisterBatch(GeneratedMetadata);
```

#### Meta â†’ Protoï¼ˆä»å…ƒæ•°æ®ç”ŸæˆProtoï¼‰

**ç”¨é€”ï¼š** æ ¹æ®å…ƒæ•°æ®å®šä¹‰è‡ªåŠ¨ç”Ÿæˆ Proto ç±»éª¨æ¶ï¼Œå‡å°‘é‡å¤ä»£ç ç¼–å†™ã€‚

**å‘½ä»¤ï¼š**
```bash
# æµ‹è¯•æ¨¡å¼ï¼ˆç”Ÿæˆåˆ° test-output/proto/ ç›®å½•ï¼‰
npm run tools:meta-to-proto -- --test ENTER_MAP

# æ­£å¼æ¨¡å¼ï¼ˆç”Ÿæˆåˆ° src/shared/proto/packets/ ç›®å½•ï¼‰
npm run tools:meta-to-proto ENTER_MAP
```

**è¾“å‡ºï¼š**
- è¯·æ±‚Protoï¼š`req/ENTER_MAPReqProto.ts`
- å“åº”Protoï¼š`rsp/ENTER_MAPRspProto.ts`

**ç”Ÿæˆçš„ä»£ç ç‰¹ç‚¹ï¼š**
- âœ… å®Œæ•´çš„å­—æ®µå®šä¹‰å’Œæ³¨é‡Š
- âœ… è‡ªåŠ¨ç”Ÿæˆ serialize() æ–¹æ³•
- âœ… è‡ªåŠ¨ç”Ÿæˆ fromBuffer() æ–¹æ³•ï¼ˆè¯·æ±‚Protoï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆ setter æ–¹æ³•ï¼ˆå“åº”Protoï¼‰
- âš ï¸ AMFç­‰å¤æ‚ç±»å‹æ ‡è®°ä¸º TODOï¼Œéœ€è¦æ‰‹åŠ¨å®ç°

**å·¥ä½œæµç¨‹ï¼š**
1. åœ¨ `meta/*.meta.ts` ä¸­å®šä¹‰å…ƒæ•°æ®
2. è¿è¡Œ `npm run tools:meta-to-proto -- --test COMMAND_NAME` ç”Ÿæˆæµ‹è¯•ä»£ç 
3. æ£€æŸ¥ç”Ÿæˆçš„ä»£ç æ ¼å¼
4. è¿è¡Œ `npm run tools:meta-to-proto COMMAND_NAME` ç”Ÿæˆæ­£å¼ä»£ç 
5. æ ¹æ®éœ€è¦è°ƒæ•´ç”Ÿæˆçš„ä»£ç ï¼ˆç‰¹åˆ«æ˜¯å¤æ‚ç±»å‹ï¼‰

---

### 2. Protoå®šä¹‰éªŒè¯å·¥å…· (`validate-proto.ts`)

**ç”¨é€”ï¼š** æ£€æŸ¥ Proto ç±»çš„å®šä¹‰æ˜¯å¦ç¬¦åˆè§„èŒƒã€‚

**å‘½ä»¤ï¼š**
```bash
npm run tools:validate-proto
```

**æ£€æŸ¥é¡¹ï¼š**
- âœ… ç±»åæ˜¯å¦ä»¥ Proto ç»“å°¾
- âœ… æ˜¯å¦ç»§æ‰¿è‡ª BaseProto
- âœ… æ˜¯å¦å®ç° serialize() æ–¹æ³•
- âœ… è¯·æ±‚Protoæ˜¯å¦å®ç° fromBuffer() æ–¹æ³•
- âœ… æ˜¯å¦æ­£ç¡®ä½¿ç”¨ CommandID
- âœ… å­—æ®µæ˜¯å¦æœ‰æ³¨é‡Š
- âœ… æ˜¯å¦æœ‰æ–‡æ¡£æ³¨é‡Š

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ğŸ“„ LoginReqProto.ts
  âš ï¸  å­—æ®µ session ç¼ºå°‘æ³¨é‡Š:7
  âš ï¸  è¯·æ±‚Protoå»ºè®®å®ç° static fromBuffer() æ–¹æ³•

ğŸ“„ LoginRspProto.ts
  âœ… é€šè¿‡æ‰€æœ‰æ£€æŸ¥

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡: 0 é”™è¯¯, 2 è­¦å‘Š
```

---

### 3. åè®®æ–‡æ¡£ç”Ÿæˆå·¥å…· (`generate-proto-docs.ts`)

**ç”¨é€”ï¼š** è‡ªåŠ¨æ‰«ææ‰€æœ‰ Proto å®šä¹‰ï¼Œç”Ÿæˆ Markdown æ ¼å¼çš„åè®®æ–‡æ¡£ã€‚

**å‘½ä»¤ï¼š**
```bash
npm run tools:generate-docs
```

**è¾“å‡ºï¼š**
- `docs/protocol-reference.md`

**æ–‡æ¡£å†…å®¹ï¼š**
- æ‰€æœ‰ Proto çš„åˆ—è¡¨å’Œåˆ†ç±»
- æ¯ä¸ª Proto çš„å­—æ®µè¯´æ˜
- å­—æ®µç±»å‹ã€é•¿åº¦ã€é»˜è®¤å€¼
- è‡ªåŠ¨ç”Ÿæˆçš„ç›®å½•

**ç¤ºä¾‹ï¼š**
```markdown
### LoginRspProto

**ç±»å‹:** å“åº”

**å‘½ä»¤ID:** LOGIN_IN (1001)

**å­—æ®µ:**

| å­—æ®µå | ç±»å‹ | é»˜è®¤å€¼ | é•¿åº¦ | è¯´æ˜ |
|--------|------|--------|------|------|
| userId | number | 0 | - | ç”¨æˆ·ID |
| session | Buffer | - | 8å­—èŠ‚ | ä¼šè¯å¯†é’¥ |
| nickname | string | '' | 20å­—èŠ‚ | æ˜µç§° |
```

---

## å¼€å‘å·¥ä½œæµ

### æ·»åŠ æ–°åè®®çš„æ¨èæµç¨‹

#### æ–¹å¼1ï¼šå…ˆå†™å…ƒæ•°æ®ï¼Œåç”ŸæˆProtoï¼ˆæ¨èï¼‰

é€‚åˆï¼šæ–°åŠŸèƒ½å¼€å‘ï¼Œåè®®è®¾è®¡é˜¶æ®µ

```bash
# 1. åœ¨ meta/*.meta.ts ä¸­å®šä¹‰å…ƒæ•°æ®
# ç¼–è¾‘ src/shared/protocol/meta/your-module.meta.ts

# 2. æµ‹è¯•ç”ŸæˆProto
npm run tools:meta-to-proto -- --test YOUR_COMMAND

# 3. æ£€æŸ¥ test-output/proto/ ä¸­çš„ç”Ÿæˆç»“æœ

# 4. æ­£å¼ç”Ÿæˆ
npm run tools:meta-to-proto YOUR_COMMAND

# 5. æ ¹æ®éœ€è¦è°ƒæ•´ç”Ÿæˆçš„ä»£ç 

# 6. éªŒè¯Protoå®šä¹‰
npm run tools:validate-proto

# 7. ç”Ÿæˆæ–‡æ¡£
npm run tools:generate-docs
```

#### æ–¹å¼2ï¼šå…ˆå†™Protoï¼Œåç”Ÿæˆå…ƒæ•°æ®

é€‚åˆï¼šå·²æœ‰Protoå®ç°ï¼Œéœ€è¦è¡¥å……å…ƒæ•°æ®

```bash
# 1. æ‰‹åŠ¨ç¼–å†™Protoç±»
# åˆ›å»º src/shared/proto/packets/req/xxx/YourReqProto.ts
# åˆ›å»º src/shared/proto/packets/rsp/xxx/YourRspProto.ts

# 2. æµ‹è¯•ç”Ÿæˆå…ƒæ•°æ®
npm run tools:proto-to-meta -- --test

# 3. æ£€æŸ¥ test-output/generated.meta.ts

# 4. æ­£å¼ç”Ÿæˆ
npm run tools:proto-to-meta

# 5. å°†ç”Ÿæˆçš„å…ƒæ•°æ®åˆå¹¶åˆ°å¯¹åº”çš„ meta/*.meta.ts æ–‡ä»¶

# 6. éªŒè¯
npm run tools:validate-proto

# 7. ç”Ÿæˆæ–‡æ¡£
npm run tools:generate-docs
```

---

## æ³¨æ„äº‹é¡¹

### Proto â†’ Meta è½¬æ¢

**æ”¯æŒçš„å­—æ®µç±»å‹ï¼š**
- `number` â†’ `uint32`
- `string` â†’ `string`ï¼ˆè‡ªåŠ¨æ£€æµ‹é•¿åº¦ï¼‰
- `Buffer` â†’ `hex`ï¼ˆè‡ªåŠ¨æ£€æµ‹é•¿åº¦ï¼‰
- `boolean` â†’ `uint8`

**é™åˆ¶ï¼š**
- æ— æ³•è‡ªåŠ¨è¯†åˆ« `uint8`ã€`uint16` çš„åŒºåˆ«ï¼ˆç»Ÿä¸€ä¸º `uint32`ï¼‰
- éœ€è¦æ‰‹åŠ¨è°ƒæ•´ç”Ÿæˆçš„å…ƒæ•°æ®

### Meta â†’ Proto è½¬æ¢

**æ”¯æŒçš„å…ƒæ•°æ®ç±»å‹ï¼š**
- `uint8`ã€`uint16`ã€`uint32` â†’ `number`
- `string` â†’ `string`
- `hex` â†’ `Buffer`
- `amf` â†’ `any`ï¼ˆæ ‡è®°ä¸º TODOï¼‰

**éœ€è¦æ‰‹åŠ¨å¤„ç†çš„æƒ…å†µï¼š**
- AMF ç±»å‹çš„åºåˆ—åŒ–/ååºåˆ—åŒ–
- å¤æ‚çš„åµŒå¥—ç»“æ„
- åŠ¨æ€é•¿åº¦çš„æ•°ç»„
- ç‰¹æ®Šçš„ä¸šåŠ¡é€»è¾‘

### æµ‹è¯•æ¨¡å¼çš„é‡è¦æ€§

**ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æµ‹è¯•æ¨¡å¼ï¼Ÿ**
1. é¿å…è¦†ç›–ç°æœ‰ä»£ç 
2. å¯ä»¥å…ˆæ£€æŸ¥ç”Ÿæˆç»“æœ
3. ä¾¿äºè°ƒè¯•å’Œè°ƒæ•´
4. å®‰å…¨æ€§æ›´é«˜

**å»ºè®®ï¼š**
- é¦–æ¬¡ä½¿ç”¨å·¥å…·æ—¶ï¼Œå§‹ç»ˆä½¿ç”¨ `--test` æ¨¡å¼
- æ£€æŸ¥ç”Ÿæˆçš„ä»£ç æ ¼å¼å’Œå†…å®¹
- ç¡®è®¤æ— è¯¯åå†ä½¿ç”¨æ­£å¼æ¨¡å¼

---

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ‰¾ä¸åˆ°å‘½ä»¤çš„å…ƒæ•°æ®

**åŸå› ï¼š** å…ƒæ•°æ®æ–‡ä»¶ä¸­æ²¡æœ‰å®šä¹‰è¯¥å‘½ä»¤

**è§£å†³ï¼š**
1. æ£€æŸ¥ `src/shared/protocol/meta/*.meta.ts` æ–‡ä»¶
2. ç¡®è®¤å‘½ä»¤åç§°æ‹¼å†™æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
3. ç¡®è®¤å…ƒæ•°æ®æ ¼å¼æ­£ç¡®

### é—®é¢˜ï¼šç”Ÿæˆçš„Protoä»£ç æœ‰é”™è¯¯

**åŸå› ï¼š** å…ƒæ•°æ®å®šä¹‰ä¸å®Œæ•´æˆ–ç±»å‹ä¸æ”¯æŒ

**è§£å†³ï¼š**
1. æ£€æŸ¥å…ƒæ•°æ®ä¸­çš„å­—æ®µç±»å‹æ˜¯å¦æ­£ç¡®
2. å¯¹äºå¤æ‚ç±»å‹ï¼ˆå¦‚ AMFï¼‰ï¼Œéœ€è¦æ‰‹åŠ¨å®ç°
3. è°ƒæ•´ç”Ÿæˆçš„ä»£ç ä»¥ç¬¦åˆå®é™…éœ€æ±‚

### é—®é¢˜ï¼šéªŒè¯å·¥å…·æŠ¥å‘Šå¤§é‡è­¦å‘Š

**åŸå› ï¼š** ä»£ç ç¼ºå°‘æ³¨é‡Šæˆ–ä¸ç¬¦åˆè§„èŒƒ

**è§£å†³ï¼š**
1. ä¸ºå­—æ®µæ·»åŠ æ³¨é‡Š
2. ä¸ºç±»æ·»åŠ æ–‡æ¡£æ³¨é‡Š
3. å®ç°ç¼ºå¤±çš„æ–¹æ³•ï¼ˆå¦‚ fromBufferï¼‰

---

## æ‰©å±•å·¥å…·

å¦‚æœéœ€è¦æ·»åŠ æ–°çš„å·¥å…·æˆ–åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒç°æœ‰å·¥å…·çš„å®ç°ï¼š

1. åˆ›å»ºæ–°çš„ `.ts` æ–‡ä»¶
2. åœ¨ `package.json` ä¸­æ·»åŠ å¯¹åº”çš„ npm script
3. æ›´æ–°æœ¬æ–‡æ¡£

**ç¤ºä¾‹ï¼š**
```json
{
  "scripts": {
    "tools:your-tool": "ts-node tools/your-tool.ts"
  }
}
```

---

## ç›¸å…³æ–‡æ¡£

- [CLAUDE.md](../CLAUDE.md) - å¼€å‘è§„èŒƒå’Œæ¶æ„è¯´æ˜
- [docs/architecture.md](../docs/architecture.md) - è¯¦ç»†æ¶æ„æ–‡æ¡£
- [docs/protocol-reference.md](../docs/protocol-reference.md) - åè®®å‚è€ƒæ–‡æ¡£ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰


---

### 4. åè®®åˆ†æå·¥å…· (`analyze-protocol.ts`)

**ç”¨é€”ï¼š** ä»å‰ç«¯ ActionScript æºç ä¸­æå–åè®®å®šä¹‰ï¼Œç”Ÿæˆ meta å®šä¹‰ä»£ç ã€‚

**å‘½ä»¤ï¼š**
```bash
# åˆ†æå•ä¸ªæ–‡ä»¶
npx ts-node tools/analyze-protocol.ts ../src/core/com/robot/core/info/SystemMsgInfo.as

# æ‰«ææ•´ä¸ªç›®å½•
npx ts-node tools/analyze-protocol.ts --scan ../src/core/com/robot/core/info
```

**åŠŸèƒ½ï¼š**
- è§£æ ActionScript Info ç±»
- æå–å­—æ®µå®šä¹‰å’Œç±»å‹ï¼ˆä» readXxx æ–¹æ³•æ¨æ–­ï¼‰
- ç”Ÿæˆå¯¹åº”çš„ meta å®šä¹‰ä»£ç 
- æ‰¹é‡æ‰«æç›®å½•

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ç±»å: SystemMsgInfo
å­—æ®µæ•°: 5

å­—æ®µåˆ—è¡¨:
  type: uint16 (readShort)
  npc: uint16 (readShort)
  msgTime: uint32 (readUnsignedInt)
  msgLen: uint32 (readUnsignedInt)
  msg: string (readUTFBytes(this.msgLen))

ç”Ÿæˆçš„ Meta å®šä¹‰:

  {
    cmdID: CommandID.COMMAND_NAME,
    name: 'COMMAND_NAME',
    desc: 'SystemMsgInfo',
    request: [],
    response: [
      { name: 'type', type: 'uint16', desc: 'type' },
      { name: 'npc', type: 'uint16', desc: 'npc' },
      { name: 'msgTime', type: 'uint32', desc: 'msgTime' },
      { name: 'msgLen', type: 'uint32', desc: 'msgLen' },
      { name: 'msg', type: 'string', lengthField: 'msgLen', desc: 'msg' }
    ]
  }
```

---

### 5. æ•°æ®åŒ…å¯¹æ¯”å·¥å…· (`compare-packet.ts`)

**ç”¨é€”ï¼š** å¯¹æ¯”å®é™…æ•°æ®åŒ…å’Œ meta å®šä¹‰ï¼Œæ‰¾å‡ºæœªè§£æçš„å­—æ®µã€‚è¿™æ˜¯æœ€å®ç”¨çš„è°ƒè¯•å·¥å…·ï¼

**å‘½ä»¤ï¼š**
```bash
# åˆ†æå“åº”åŒ…
npx ts-node tools/compare-packet.ts 8002 "000100000000000000000001c3..."

# åˆ†æè¯·æ±‚åŒ…
npx ts-node tools/compare-packet.ts 1001 "a1b2c3d4..." --request
```

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºå­—æ®µè§£æè¯¦æƒ…ï¼ˆå€¼ã€ç±»å‹ã€åç§»ã€é•¿åº¦ï¼‰
- æ ‡è®°æœªè§£æçš„å‰©ä½™æ•°æ®
- åˆ†æå‰©ä½™æ•°æ®çš„å¯èƒ½ç±»å‹ï¼ˆUTF-8æ–‡æœ¬ã€æ•°ç»„ã€å¡«å……ç­‰ï¼‰
- æä¾› Hex å’Œ UTF-8 è§†å›¾
- è‡ªåŠ¨æ£€æµ‹æ•°æ®æ¨¡å¼

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
================================================================================
å‘½ä»¤ID: 8002
å‘½ä»¤å: SYSTEM_MESSAGE
æè¿°: ç³»ç»Ÿé€šçŸ¥æ¶ˆæ¯
æ–¹å‘: å“åº”
æ•°æ®é•¿åº¦: 467 å­—èŠ‚
================================================================================

ğŸ“‹ å­—æ®µå®šä¹‰:
  1. type (uint16): 1
      æè¿°: æ¶ˆæ¯ç±»å‹
      åç§»: 0 - 1 (2 å­—èŠ‚)

  2. npc (uint16): 0
      æè¿°: NPC ID
      åç§»: 2 - 3 (2 å­—èŠ‚)

  3. msgTime (uint32): 0
      æè¿°: æ¶ˆæ¯æ—¶é—´æˆ³
      åç§»: 4 - 7 (4 å­—èŠ‚)

  4. msgLength (uint32): 451
      æè¿°: æ¶ˆæ¯é•¿åº¦
      åç§»: 8 - 11 (4 å­—èŠ‚)

  5. message (string): "<font size="13">..."
      æè¿°: æ¶ˆæ¯å†…å®¹(HTMLæ ¼å¼)
      åç§»: 12 - 462 (451 å­—èŠ‚)

âœ… æ‰€æœ‰æ•°æ®å·²è§£æå®Œæ¯•
```

**å¦‚æœæœ‰å‰©ä½™æ•°æ®ï¼š**
```
âš ï¸  å‰©ä½™æœªè§£ææ•°æ®:
  é•¿åº¦: 100 å­—èŠ‚
  åç§»: 467 - 566

  Hex:
    0000: 00 00 00 01 00 00 00 02 00 00 00 03 00 00 00 04 | ................
    0010: 00 00 00 05 00 00 00 06 00 00 00 07 00 00 00 08 | ................
    ...

  UTF-8 å°è¯•:
    Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·

  ğŸ“Š æ•°æ®åˆ†æ:
    - å¯èƒ½æ˜¯ uint32 æ•°ç»„:
      [1, 2, 3, 4, 5, 6, 7, 8, ...]
```

**ä½¿ç”¨åœºæ™¯ï¼š**
1. **è¡¥å……åè®®å®šä¹‰** - å‘ç° remaining æ•°æ®æ—¶ï¼Œä½¿ç”¨æ­¤å·¥å…·åˆ†æ
2. **éªŒè¯è§£ææ­£ç¡®æ€§** - æ£€æŸ¥å­—æ®µå€¼æ˜¯å¦ç¬¦åˆé¢„æœŸ
3. **è°ƒè¯•åè®®é—®é¢˜** - å¿«é€Ÿå®šä½è§£æé”™è¯¯çš„ä½ç½®
4. **é€†å‘å·¥ç¨‹** - åˆ†ææœªçŸ¥åè®®çš„ç»“æ„

**å·¥ä½œæµç¨‹ï¼š**
```bash
# 1. ä» ProxyServer æ—¥å¿—ä¸­å¤åˆ¶æ•°æ®åŒ… Hex
# 2. è¿è¡Œå¯¹æ¯”å·¥å…·
npx ts-node tools/compare-packet.ts 8002 "00010000..."

# 3. æŸ¥çœ‹å‰©ä½™æ•°æ®åˆ†æ
# 4. æ ¹æ®åˆ†æç»“æœæ›´æ–° meta å®šä¹‰
# 5. é‡æ–°è¿è¡ŒéªŒè¯
```

---

## åè®®è¡¥å…¨å·¥ä½œæµ

å½“ä½ å‘ç°æŸä¸ªåè®®æœ‰ `remaining` æ•°æ®æ— æ³•è§£ææ—¶ï¼š

### æ­¥éª¤ 1: ä½¿ç”¨æ•°æ®åŒ…å¯¹æ¯”å·¥å…·

```bash
npx ts-node tools/compare-packet.ts <cmdId> <bodyHex>
```

æŸ¥çœ‹å‰©ä½™æ•°æ®çš„ç‰¹å¾ï¼š
- æ˜¯å¦æ˜¯æ–‡æœ¬ï¼Ÿ
- æ˜¯å¦æ˜¯æ•°ç»„ï¼Ÿ
- æ˜¯å¦æ˜¯å¡«å……æ•°æ®ï¼Ÿ

### æ­¥éª¤ 2: æŸ¥æ‰¾å‰ç«¯æºç 

```bash
# åœ¨å‰ç«¯æºç ä¸­æœç´¢å¯¹åº”çš„ Info ç±»
npx ts-node tools/analyze-protocol.ts --scan ../src/core/com/robot/core/info
```

æ‰¾åˆ°å¯¹åº”çš„ Info ç±»æ–‡ä»¶ã€‚

### æ­¥éª¤ 3: åˆ†æå‰ç«¯ä»£ç 

```bash
npx ts-node tools/analyze-protocol.ts ../src/core/com/robot/core/info/YourInfo.as
```

è·å–å®Œæ•´çš„å­—æ®µå®šä¹‰ã€‚

### æ­¥éª¤ 4: æ›´æ–° meta å®šä¹‰

å°†ç”Ÿæˆçš„ meta å®šä¹‰å¤åˆ¶åˆ°å¯¹åº”çš„ `meta/*.meta.ts` æ–‡ä»¶ä¸­ã€‚

### æ­¥éª¤ 5: éªŒè¯

```bash
# é‡æ–°ç¼–è¯‘
npm run build

# å†æ¬¡è¿è¡Œå¯¹æ¯”å·¥å…·éªŒè¯
npx ts-node tools/compare-packet.ts <cmdId> <bodyHex>
```

åº”è¯¥çœ‹åˆ° `âœ… æ‰€æœ‰æ•°æ®å·²è§£æå®Œæ¯•`ã€‚

---

## æ–°å¢åŠŸèƒ½ï¼šåŠ¨æ€é•¿åº¦å­—æ®µæ”¯æŒ

ç°åœ¨ meta ç³»ç»Ÿæ”¯æŒ `lengthField` å±æ€§ï¼Œç”¨äºæŒ‡å®šåŠ¨æ€é•¿åº¦å­—æ®µï¼š

```typescript
{
  name: 'msgLength',
  type: 'uint32',
  desc: 'æ¶ˆæ¯é•¿åº¦'
},
{
  name: 'message',
  type: 'string',
  lengthField: 'msgLength',  // é•¿åº¦ä» msgLength å­—æ®µè¯»å–
  desc: 'æ¶ˆæ¯å†…å®¹'
}
```

æ”¯æŒçš„ç±»å‹ï¼š
- `string` - åŠ¨æ€é•¿åº¦å­—ç¬¦ä¸²
- `bytes` - åŠ¨æ€é•¿åº¦å­—èŠ‚æ•°ç»„
- `hex` - åŠ¨æ€é•¿åº¦åå…­è¿›åˆ¶æ•°æ®

è¿™è§£å†³äº†å¾ˆå¤šåè®®ä¸­"é•¿åº¦+å†…å®¹"çš„æ¨¡å¼ã€‚
